/************************************************/
#include "SGE-AsmMacros.h"
#include "SGE-GBANDS.h"
/************************************************/
#if SGE_VARIABLE_SYNC_RATE
/************************************************/

ASM_DATA_GLOBAL(SGE_RecpLUT)
ASM_DATA_BEG   (SGE_RecpLUT, ASM_DATASECT_RODATA;ASM_ALIGN(4))

@ This generates 1/x for x = Beg..(End-1)
.macro RecpLUT_WriteEntry x
#if (SGE_RECPLUT_BITS == 8)
	.byte \x
#elif (SGE_RECPLUT_BITS == 16)
	.hword \x
#elif (SGE_RECPLUT_BITS == 32)
	.word \x
#endif
.endm
.macro RecpLUT_WriteClipped x
	.if (\x) < (1<<SGE_RECPLUT_PRECISION)
		RecpLUT_WriteEntry \x
	.else
		RecpLUT_WriteEntry ((1<<SGE_RECPLUT_PRECISION)-1)
	.endif
.endm
.macro MakeDivTable Beg, End
	.if \Beg < \End
		.if \Beg == 0
			RecpLUT_WriteEntry ((1<<SGE_RECPLUT_PRECISION)-1)
		.else
			RecpLUT_WriteClipped ((((1<<SGE_RECPLUT_PRECISION)-1) / (\Beg)) + 1)
		.endif
		MakeDivTable (\Beg)+1, \End
	.endif
.endm

SGE_RecpLUT:
	@ Splitting the table up should reduce issues with exceeding nesting levels
.irp x, 0,1,2,3,4,5,6,7
	MakeDivTable (256 * \x / 8), (256 * (\x+1) / 8)
.endr

ASM_DATA_END(SGE_RecpLUT)
ASM_WEAK    (SGE_RecpLUT)

/************************************************/
#else
/************************************************/

ASM_DATA_GLOBAL(SGE_EnvelopeLUT_Linear)
ASM_DATA_BEG   (SGE_EnvelopeLUT_Linear, ASM_DATASECT_RODATA;ASM_ALIGN(2))

@ d = 2^16 / (EnvTime / MsecPerUpdate)
@   = 2^16 * MsecPerUpdate / EnvTime
@   = 2^16 * (1000 * AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) / EnvTime
@   = 2^-8 * 1000 * AGB_FRAME_CYCLES / EnvTime
@   = Numer(=1097250) / EnvTime
@   = Numer / (CompandedEnvTime^2 * 1000/1626)
@   = Numer*1626/1000 / CompandedEnvTime^2
@ ---
@ f[x_] := Clip[Floor[1097250*1626/1000 / x^2], {0, 65535}];
@ f[#] &@ Range[0, 255]
SGE_EnvelopeLUT_Linear:
#ifdef __GBA__
	.hword 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xC197,0x8E3A
	.hword 0x6CE5,0x560A,0x45B1,0x3998,0x3065,0x293C,0x238E,0x1EF9
	.hword 0x1B39,0x181D,0x1582,0x134E,0x116C,0x0FCD,0x0E66,0x0D2C
	.hword 0x0C19,0x0B26,0x0A4F,0x098F,0x08E3,0x0849,0x07BE,0x0740
	.hword 0x06CE,0x0666,0x0607,0x05B0,0x0560,0x0517,0x04D3,0x0494
	.hword 0x045B,0x0425,0x03F3,0x03C4,0x0399,0x0371,0x034B,0x0327
	.hword 0x0306,0x02E7,0x02C9,0x02AD,0x0293,0x027B,0x0263,0x024D
	.hword 0x0238,0x0225,0x0212,0x0200,0x01EF,0x01DF,0x01D0,0x01C1
	.hword 0x01B3,0x01A6,0x0199,0x018D,0x0181,0x0176,0x016C,0x0161
	.hword 0x0158,0x014E,0x0145,0x013D,0x0134,0x012C,0x0125,0x011D
	.hword 0x0116,0x010F,0x0109,0x0102,0x00FC,0x00F6,0x00F1,0x00EB
	.hword 0x00E6,0x00E1,0x00DC,0x00D7,0x00D2,0x00CE,0x00C9,0x00C5
	.hword 0x00C1,0x00BD,0x00B9,0x00B6,0x00B2,0x00AE,0x00AB,0x00A8
	.hword 0x00A4,0x00A1,0x009E,0x009B,0x0098,0x0096,0x0093,0x0090
	.hword 0x008E,0x008B,0x0089,0x0086,0x0084,0x0082,0x0080,0x007D
	.hword 0x007B,0x0079,0x0077,0x0075,0x0074,0x0072,0x0070,0x006E
	.hword 0x006C,0x006B,0x0069,0x0067,0x0066,0x0064,0x0063,0x0061
	.hword 0x0060,0x005F,0x005D,0x005C,0x005B,0x0059,0x0058,0x0057
	.hword 0x0056,0x0054,0x0053,0x0052,0x0051,0x0050,0x004F,0x004E
	.hword 0x004D,0x004C,0x004B,0x004A,0x0049,0x0048,0x0047,0x0046
	.hword 0x0045,0x0044,0x0043,0x0043,0x0042,0x0041,0x0040,0x003F
	.hword 0x003F,0x003E,0x003D,0x003D,0x003C,0x003B,0x003A,0x003A
	.hword 0x0039,0x0038,0x0038,0x0037,0x0037,0x0036,0x0035,0x0035
	.hword 0x0034,0x0034,0x0033,0x0033,0x0032,0x0031,0x0031,0x0030
	.hword 0x0030,0x002F,0x002F,0x002E,0x002E,0x002D,0x002D,0x002D
	.hword 0x002C,0x002C,0x002B,0x002B,0x002A,0x002A,0x002A,0x0029
	.hword 0x0029,0x0028,0x0028,0x0028,0x0027,0x0027,0x0026,0x0026
	.hword 0x0026,0x0025,0x0025,0x0025,0x0024,0x0024,0x0024,0x0023
	.hword 0x0023,0x0023,0x0022,0x0022,0x0022,0x0022,0x0021,0x0021
	.hword 0x0021,0x0020,0x0020,0x0020,0x0020,0x001F,0x001F,0x001F
	.hword 0x001E,0x001E,0x001E,0x001E,0x001D,0x001D,0x001D,0x001D
	.hword 0x001D,0x001C,0x001C,0x001C,0x001C,0x001B,0x001B,0x001B
#else
	.hword 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xC145,0x8DFE
	.hword 0x6CB7,0x55E5,0x4593,0x3980,0x3051,0x292B,0x237F,0x1EEC
	.hword 0x1B2D,0x1813,0x1579,0x1346,0x1164,0x0FC6,0x0E60,0x0D27
	.hword 0x0C14,0x0B21,0x0A4A,0x098B,0x08DF,0x0845,0x07BB,0x073D
	.hword 0x06CB,0x0663,0x0604,0x05AE,0x055E,0x0515,0x04D1,0x0493
	.hword 0x0459,0x0423,0x03F1,0x03C3,0x0398,0x036F,0x0349,0x0326
	.hword 0x0305,0x02E5,0x02C8,0x02AC,0x0292,0x027A,0x0262,0x024C
	.hword 0x0237,0x0224,0x0211,0x01FF,0x01EE,0x01DE,0x01CF,0x01C0
	.hword 0x01B2,0x01A5,0x0198,0x018C,0x0181,0x0176,0x016B,0x0161
	.hword 0x0157,0x014E,0x0145,0x013C,0x0134,0x012C,0x0124,0x011D
	.hword 0x0116,0x010F,0x0108,0x0102,0x00FC,0x00F6,0x00F0,0x00EB
	.hword 0x00E6,0x00E0,0x00DB,0x00D7,0x00D2,0x00CD,0x00C9,0x00C5
	.hword 0x00C1,0x00BD,0x00B9,0x00B5,0x00B2,0x00AE,0x00AB,0x00A7
	.hword 0x00A4,0x00A1,0x009E,0x009B,0x0098,0x0095,0x0093,0x0090
	.hword 0x008D,0x008B,0x0089,0x0086,0x0084,0x0082,0x007F,0x007D
	.hword 0x007B,0x0079,0x0077,0x0075,0x0073,0x0071,0x0070,0x006E
	.hword 0x006C,0x006B,0x0069,0x0067,0x0066,0x0064,0x0063,0x0061
	.hword 0x0060,0x005E,0x005D,0x005C,0x005A,0x0059,0x0058,0x0057
	.hword 0x0055,0x0054,0x0053,0x0052,0x0051,0x0050,0x004F,0x004E
	.hword 0x004D,0x004C,0x004B,0x004A,0x0049,0x0048,0x0047,0x0046
	.hword 0x0045,0x0044,0x0043,0x0043,0x0042,0x0041,0x0040,0x003F
	.hword 0x003F,0x003E,0x003D,0x003C,0x003C,0x003B,0x003A,0x003A
	.hword 0x0039,0x0038,0x0038,0x0037,0x0036,0x0036,0x0035,0x0035
	.hword 0x0034,0x0034,0x0033,0x0032,0x0032,0x0031,0x0031,0x0030
	.hword 0x0030,0x002F,0x002F,0x002E,0x002E,0x002D,0x002D,0x002C
	.hword 0x002C,0x002C,0x002B,0x002B,0x002A,0x002A,0x0029,0x0029
	.hword 0x0029,0x0028,0x0028,0x0028,0x0027,0x0027,0x0026,0x0026
	.hword 0x0026,0x0025,0x0025,0x0025,0x0024,0x0024,0x0024,0x0023
	.hword 0x0023,0x0023,0x0022,0x0022,0x0022,0x0021,0x0021,0x0021
	.hword 0x0021,0x0020,0x0020,0x0020,0x001F,0x001F,0x001F,0x001F
	.hword 0x001E,0x001E,0x001E,0x001E,0x001D,0x001D,0x001D,0x001D
	.hword 0x001C,0x001C,0x001C,0x001C,0x001C,0x001B,0x001B,0x001B
#endif

ASM_DATA_END(SGE_EnvelopeLUT_Linear)

/************************************************/

ASM_DATA_GLOBAL(SGE_EnvelopeLUT_ExpDec)
ASM_DATA_BEG   (SGE_EnvelopeLUT_ExpDec, ASM_DATASECT_RODATA;ASM_ALIGN(2))

@ d = 2^(16 + Log2[-100dB] / (EnvTime / MsecPerUpdate))
@   = 2^(16 + Log2[-100dB] * MsecPerUpdate / EnvTime)
@   = 2^(16 + Log2[-100dB] * (1000 * AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) / EnvTime)
@   = 2^(16 + Log2[-100dB] * (1000 * AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) / EnvTime)
@   = 2^(16 + Log2[-100dB] * (1000 * AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) / (CompandedEnvTime^2 * 1000/1626))
@   = 2^(16 + Log2[-100dB] * (1000 * AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) * 1626/1000 / CompandedEnvTime^2)
@ ---
@ f[x_] := Ceiling[2^(16 + Log2[10^(-100/20)]*(1000*AGB_FRAME_CYCLES/AGB_HW_FREQ_HZ) * 1626/1000 / x^2)];
@ f[#] &@ Range[0, 255]
SGE_EnvelopeLUT_ExpDec:
#ifdef __GBA__
	.hword 0x0000,0x0001,0x0001,0x0001,0x0001,0x0001,0x000B,0x006E
	.hword 0x01EA,0x0558,0x0B25,0x1334,0x1D0A,0x2812,0x33BC,0x3F93
	.hword 0x4B41,0x568C,0x614E,0x6B72,0x74F0,0x7DC6,0x85F9,0x8D8F
	.hword 0x9492,0x9B0B,0xA106,0xA68B,0xABA4,0xB05B,0xB4B8,0xB8C2
	.hword 0xBC81,0xBFFA,0xC335,0xC636,0xC902,0xCB9E,0xCE0E,0xD054
	.hword 0xD276,0xD475,0xD654,0xD816,0xD9BD,0xDB4B,0xDCC2,0xDE23
	.hword 0xDF71,0xE0AC,0xE1D6,0xE2F1,0xE3FC,0xE4F9,0xE5EA,0xE6CE
	.hword 0xE7A7,0xE876,0xE93A,0xE9F6,0xEAA8,0xEB52,0xEBF5,0xEC90
	.hword 0xED25,0xEDB3,0xEE3B,0xEEBD,0xEF3A,0xEFB1,0xF024,0xF092
	.hword 0xF0FC,0xF161,0xF1C3,0xF221,0xF27B,0xF2D2,0xF326,0xF377
	.hword 0xF3C4,0xF40F,0xF458,0xF49E,0xF4E1,0xF522,0xF561,0xF59E
	.hword 0xF5D9,0xF612,0xF649,0xF67E,0xF6B2,0xF6E4,0xF715,0xF744
	.hword 0xF771,0xF79D,0xF7C8,0xF7F2,0xF81A,0xF842,0xF868,0xF88D
	.hword 0xF8B1,0xF8D4,0xF8F6,0xF917,0xF937,0xF956,0xF975,0xF992
	.hword 0xF9AF,0xF9CB,0xF9E7,0xFA02,0xFA1C,0xFA35,0xFA4E,0xFA66
	.hword 0xFA7D,0xFA94,0xFAAB,0xFAC1,0xFAD6,0xFAEB,0xFAFF,0xFB13
	.hword 0xFB27,0xFB3A,0xFB4C,0xFB5E,0xFB70,0xFB82,0xFB92,0xFBA3
	.hword 0xFBB3,0xFBC3,0xFBD3,0xFBE2,0xFBF1,0xFBFF,0xFC0E,0xFC1C
	.hword 0xFC29,0xFC37,0xFC44,0xFC51,0xFC5D,0xFC6A,0xFC76,0xFC82
	.hword 0xFC8D,0xFC99,0xFCA4,0xFCAF,0xFCBA,0xFCC4,0xFCCF,0xFCD9
	.hword 0xFCE3,0xFCED,0xFCF6,0xFD00,0xFD09,0xFD12,0xFD1B,0xFD24
	.hword 0xFD2D,0xFD35,0xFD3E,0xFD46,0xFD4E,0xFD56,0xFD5E,0xFD65
	.hword 0xFD6D,0xFD74,0xFD7B,0xFD83,0xFD8A,0xFD91,0xFD97,0xFD9E
	.hword 0xFDA5,0xFDAB,0xFDB1,0xFDB8,0xFDBE,0xFDC4,0xFDCA,0xFDD0
	.hword 0xFDD6,0xFDDB,0xFDE1,0xFDE7,0xFDEC,0xFDF1,0xFDF7,0xFDFC
	.hword 0xFE01,0xFE06,0xFE0B,0xFE10,0xFE15,0xFE1A,0xFE1E,0xFE23
	.hword 0xFE27,0xFE2C,0xFE30,0xFE35,0xFE39,0xFE3D,0xFE42,0xFE46
	.hword 0xFE4A,0xFE4E,0xFE52,0xFE56,0xFE59,0xFE5D,0xFE61,0xFE65
	.hword 0xFE68,0xFE6C,0xFE70,0xFE73,0xFE77,0xFE7A,0xFE7D,0xFE81
	.hword 0xFE84,0xFE87,0xFE8A,0xFE8E,0xFE91,0xFE94,0xFE97,0xFE9A
	.hword 0xFE9D,0xFEA0,0xFEA3,0xFEA6,0xFEA8,0xFEAB,0xFEAE,0xFEB1
	.hword 0xFEB3,0xFEB6,0xFEB9,0xFEBB,0xFEBE,0xFEC0,0xFEC3,0xFEC5
#else
	.hword 0x0000,0x0001,0x0001,0x0001,0x0001,0x0001,0x000C,0x006F
	.hword 0x01EE,0x0561,0x0B34,0x1349,0x1D25,0x2832,0x33DF,0x3FB8
	.hword 0x4B68,0x56B4,0x6176,0x6B99,0x7517,0x7DEC,0x861D,0x8DB2
	.hword 0x94B4,0x9B2C,0xA125,0xA6A9,0xABC1,0xB077,0xB4D2,0xB8DB
	.hword 0xBC99,0xC012,0xC34B,0xC64B,0xC917,0xCBB2,0xCE20,0xD067
	.hword 0xD287,0xD486,0xD664,0xD825,0xD9CC,0xDB59,0xDCD0,0xDE31
	.hword 0xDF7E,0xE0B9,0xE1E2,0xE2FC,0xE407,0xE504,0xE5F4,0xE6D8
	.hword 0xE7B1,0xE87F,0xE943,0xE9FE,0xEAB1,0xEB5B,0xEBFD,0xEC98
	.hword 0xED2C,0xEDBA,0xEE42,0xEEC4,0xEF40,0xEFB8,0xF02A,0xF098
	.hword 0xF102,0xF167,0xF1C9,0xF226,0xF281,0xF2D7,0xF32B,0xF37C
	.hword 0xF3C9,0xF414,0xF45D,0xF4A2,0xF4E6,0xF527,0xF566,0xF5A2
	.hword 0xF5DD,0xF616,0xF64D,0xF682,0xF6B6,0xF6E8,0xF718,0xF747
	.hword 0xF775,0xF7A1,0xF7CC,0xF7F5,0xF81E,0xF845,0xF86B,0xF890
	.hword 0xF8B4,0xF8D7,0xF8F9,0xF91A,0xF93A,0xF959,0xF977,0xF995
	.hword 0xF9B2,0xF9CE,0xF9E9,0xFA04,0xFA1E,0xFA37,0xFA50,0xFA68
	.hword 0xFA80,0xFA97,0xFAAD,0xFAC3,0xFAD8,0xFAED,0xFB01,0xFB15
	.hword 0xFB29,0xFB3C,0xFB4E,0xFB60,0xFB72,0xFB83,0xFB94,0xFBA5
	.hword 0xFBB5,0xFBC5,0xFBD4,0xFBE4,0xFBF3,0xFC01,0xFC0F,0xFC1D
	.hword 0xFC2B,0xFC38,0xFC45,0xFC52,0xFC5F,0xFC6B,0xFC77,0xFC83
	.hword 0xFC8F,0xFC9A,0xFCA6,0xFCB0,0xFCBB,0xFCC6,0xFCD0,0xFCDA
	.hword 0xFCE4,0xFCEE,0xFCF8,0xFD01,0xFD0A,0xFD14,0xFD1D,0xFD25
	.hword 0xFD2E,0xFD36,0xFD3F,0xFD47,0xFD4F,0xFD57,0xFD5F,0xFD66
	.hword 0xFD6E,0xFD75,0xFD7C,0xFD84,0xFD8B,0xFD92,0xFD98,0xFD9F
	.hword 0xFDA6,0xFDAC,0xFDB2,0xFDB9,0xFDBF,0xFDC5,0xFDCB,0xFDD1
	.hword 0xFDD7,0xFDDC,0xFDE2,0xFDE7,0xFDED,0xFDF2,0xFDF8,0xFDFD
	.hword 0xFE02,0xFE07,0xFE0C,0xFE11,0xFE16,0xFE1A,0xFE1F,0xFE24
	.hword 0xFE28,0xFE2D,0xFE31,0xFE36,0xFE3A,0xFE3E,0xFE42,0xFE46
	.hword 0xFE4A,0xFE4E,0xFE52,0xFE56,0xFE5A,0xFE5E,0xFE62,0xFE65
	.hword 0xFE69,0xFE6D,0xFE70,0xFE74,0xFE77,0xFE7B,0xFE7E,0xFE81
	.hword 0xFE85,0xFE88,0xFE8B,0xFE8E,0xFE91,0xFE94,0xFE97,0xFE9A
	.hword 0xFE9D,0xFEA0,0xFEA3,0xFEA6,0xFEA9,0xFEAC,0xFEAF,0xFEB1
	.hword 0xFEB4,0xFEB7,0xFEB9,0xFEBC,0xFEBE,0xFEC1,0xFEC3,0xFEC6
#endif

ASM_DATA_END(SGE_EnvelopeLUT_ExpDec)

/************************************************/
#endif
/************************************************/
//! EOF
/************************************************/
